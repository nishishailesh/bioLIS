<?php


//require_once('tcpdf/config/lang/eng.php');
require_once('tcpdf/tcpdf.php');
require_once('reference_interval.php');
// calibration, EQC,Kit,checklist

/////////donot do anything above/////////
$reflex='yes';
/////////do not do anything below////////

//$GLOBALS['final_stage']=array('verified','released');
$GLOBALS['final_stage']=array('released');

					//if 'no'=>it will bypass reflex testing
date_default_timezone_set('Asia/Kolkata');

/////////////////////////////////////////////
////////////mysql to mysqli//////////////////
/////////////////////////////////////////////

$GLOBALS['link']='';

if(substr(phpversion(),0,1)>=7)
{
	require_once 'new_to_old.php';
}
///////comment upto here to enable older mysql <7
/////////////////////////////////

///////////////////For user setting change////////////////////
function get_link($u,$p)
{
	$link=mysql_connect('127.0.0.1',$u,$p);
	if(!$link)
	{
		echo 'error1:'.mysql_error(); 
		return false;
	}
	return $link;
}

function run_query($link,$db,$sql)
{
	$db_success=mysql_select_db($db,$link);
	
	if(!$db_success)
	{
		echo 'error2:'.mysql_error(); return false;
	}
	else
	{
		$result=mysql_query($sql,$link);
	}
	
	if(!$result)
	{
		echo 'error3:'.mysql_error(); return false;
	}
	else
	{
		return $result;
	}	
}

function get_single_row($result)
{
		if($result!=false)
		{
			return mysql_fetch_assoc($result);
		}
		else
		{
			return false;
		}
}

function my_safe_text($link,$str)
{
	return mysqli_real_escape_string($link,$str);
}

/*

 CREATE TABLE `user` (
  `user` varchar(100) NOT NULL,
  `password` varchar(500) NOT NULL,
  `expirydate` date NOT NULL
)

*/


//create user table
//change root password // or create saparate user
//assign password to all users

function login_varify()
{
				
    if(!$link=get_link('dfasd345','df54*(&sdf')){return false;}
    
    $sql='select * from user where user = \''.$_SESSION['login'].'\'';
    $result=run_query($link,'biochemistry',$sql);
    if($result===FALSE)
    {
		//echo mysqli_error($link);
		return false;
	}
    
    $result_array=get_single_row($result);
    if(!password_verify($_SESSION['password'],$result_array['password'])){return false;}
    
    if(strtotime($result_array['expirydate']) < strtotime(date("Y-m-d")))
    {
		return 101;
	}
    return 100;
}
/////////////////////////////////
function select_nchsls($link)
{
	return mysql_select_db('biochemistry',$link);
}

///////////////////////////////////
function start_nchsls()
{
	$ret=login_varify();